
 plate_paths={   
            '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090203_MZ_w2Tf_w3EEA1',...
       '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090203_MZ_w2Tf_w3EEA1',...
  '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090928_A431_w2LAMP1_w3ChtxAW1', ...
  '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090928_A431_w2LAMP1_w3ChtxAW1', ...
              '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090309_A431_w2ChtxNAW_w3GM130', ...
                    '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090309_A431_w2ChtxNAW_w3GM130', ...
  '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090217_A431_w2Tf_w3EEA1',  ...
   '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090217_A431_w2Tf_w3EEA1',  ...
  '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090403_A431_w2GM1_w3Dextran', ...
  '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090403_A431_w2GM1_w3Dextran', ...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/091127_A431_w3ChtxAW2',...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/100215_A431_w3LDL',...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/100224_A431_w2EGF_w3CAV1',...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/100224_A431_w2EGF_w3CAV1',...
                       '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/091113_A431_w3GPIGFP',...
        '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/100402_A431_w3Macro',...
        '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/110721_MZ_w2EGF'
         };
            
            
%             'Y:\Prisca\endocytome\090203_MZ_w2Tf_w3EEA1\090203_Mz_Tf_EEA1_CP392-1ad\BATCH',...
%                          'Y:\Prisca\endocytome\090203_MZ_w2Tf_w3EEA1\090203_Mz_Tf_EEA1_CP393-1ad\BATCH',...
%                          'Y:\Prisca\endocytome\090203_MZ_w2Tf_w3EEA1\090203_Mz_Tf_EEA1_CP394-1ad\BATCH',...
%                          'Y:\Prisca\endocytome\090203_MZ_w2Tf_w3EEA1\090203_Mz_Tf_EEA1_CP395-1ad\BATCH', ...
plate1_paths={    '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090203_MZ_w2Tf_w3EEA1/090203_Mz_Tf_EEA1_CP392-1ad/BATCH',...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090203_MZ_w2Tf_w3EEA1/090203_Mz_Tf_EEA1_CP393-1ad/BATCH',...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090203_MZ_w2Tf_w3EEA1/090203_Mz_Tf_EEA1_CP394-1ad/BATCH',...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090203_MZ_w2Tf_w3EEA1/090203_Mz_Tf_EEA1_CP395-1ad/BATCH', ...
                          '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090203_MZ_w2Tf_w3EEA1/090203_Mz_Tf_EEA1_CP392-1ad/BATCH',...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090203_MZ_w2Tf_w3EEA1/090203_Mz_Tf_EEA1_CP393-1ad/BATCH',...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090203_MZ_w2Tf_w3EEA1/090203_Mz_Tf_EEA1_CP394-1ad/BATCH',...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090203_MZ_w2Tf_w3EEA1/090203_Mz_Tf_EEA1_CP395-1ad/BATCH', ...
       '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090928_A431_w2LAMP1_w3ChtxAW1/090309_A431_Chtx_Lamp1_CP392-1ba/BATCH', ...
                          '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090928_A431_w2LAMP1_w3ChtxAW1/090309_A431_Chtx_Lamp1_CP393-1ba/BATCH', ...
                          '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090928_A431_w2LAMP1_w3ChtxAW1/090309_A431_Chtx_Lamp1_CP394-1ba/BATCH', ...
                           '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090928_A431_w2LAMP1_w3ChtxAW1/090309_A431_Chtx_Lamp1_CP395-1ba/BATCH', ...
                              '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090928_A431_w2LAMP1_w3ChtxAW1/090309_A431_Chtx_Lamp1_CP392-1ba/BATCH', ...
                          '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090928_A431_w2LAMP1_w3ChtxAW1/090309_A431_Chtx_Lamp1_CP393-1ba/BATCH', ...
                          '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090928_A431_w2LAMP1_w3ChtxAW1/090309_A431_Chtx_Lamp1_CP394-1ba/BATCH', ...
                           '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090928_A431_w2LAMP1_w3ChtxAW1/090309_A431_Chtx_Lamp1_CP395-1ba/BATCH', ...
              '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090309_A431_w2ChtxNAW_w3GM130/090309_A431-Chtx-GM130-CP392-1af/BATCH', ...
                        '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090309_A431_w2ChtxNAW_w3GM130/090309_A431-Chtx-GM130-CP393-1af/BATCH', ...
                        '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090309_A431_w2ChtxNAW_w3GM130/090309_A431-Chtx-GM130-CP394-1af/BATCH', ...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090309_A431_w2ChtxNAW_w3GM130/090309_A431-Chtx-GM130-CP395-1af/BATCH', ...
              '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090309_A431_w2ChtxNAW_w3GM130/090309_A431-Chtx-GM130-CP392-1af/BATCH', ...
                        '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090309_A431_w2ChtxNAW_w3GM130/090309_A431-Chtx-GM130-CP393-1af/BATCH', ...
                        '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090309_A431_w2ChtxNAW_w3GM130/090309_A431-Chtx-GM130-CP394-1af/BATCH', ...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090309_A431_w2ChtxNAW_w3GM130/090309_A431-Chtx-GM130-CP395-1af/BATCH', ...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090217_A431_w2Tf_w3EEA1/090217_A431_Tf_EEA1_CP392-1ae/BATCH',  ...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090217_A431_w2Tf_w3EEA1/090217_A431_Tf_EEA1_CP393-1ae/BATCH', ...
                             '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090217_A431_w2Tf_w3EEA1/090217_A431_Tf_EEA1_CP394-1ae/BATCH' , ...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090217_A431_w2Tf_w3EEA1/090217_A431_Tf_EEA1_CP395-1ae/BATCH', ...
                               '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090217_A431_w2Tf_w3EEA1/090217_A431_Tf_EEA1_CP392-1ae/BATCH',  ...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090217_A431_w2Tf_w3EEA1/090217_A431_Tf_EEA1_CP393-1ae/BATCH', ...
                             '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090217_A431_w2Tf_w3EEA1/090217_A431_Tf_EEA1_CP394-1ae/BATCH' , ...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090217_A431_w2Tf_w3EEA1/090217_A431_Tf_EEA1_CP395-1ae/BATCH', ...
 '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090403_A431_w2GM1_w3Dextran/090403_A431_Dextran_GM1-CP392-1ag/BATCH', ...
                        '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090403_A431_w2GM1_w3Dextran/090403_A431_Dextran_GM1-CP393-1ag/BATCH', ...
                        '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090403_A431_w2GM1_w3Dextran/090403_A431_Dextran_GM1-CP394-1ag/BATCH', ...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090403_A431_w2GM1_w3Dextran/090403_A431_Dextran_GM1-CP395-1ag/BATCH', ...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090403_A431_w2GM1_w3Dextran/090403_A431_Dextran_GM1-CP392-1ag/BATCH', ...
                        '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090403_A431_w2GM1_w3Dextran/090403_A431_Dextran_GM1-CP393-1ag/BATCH', ...
                        '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090403_A431_w2GM1_w3Dextran/090403_A431_Dextran_GM1-CP394-1ag/BATCH', ...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/090403_A431_w2GM1_w3Dextran/090403_A431_Dextran_GM1-CP395-1ag/BATCH', ...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/091127_A431_w3ChtxAW2/091127_A431_Chtx_Golgi_AcidWash_CP392-1bf/BATCH',...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/091127_A431_w3ChtxAW2/091127_A431_Chtx_Golgi_AcidWash_CP393-1bf/BATCH',...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/091127_A431_w3ChtxAW2/091127_A431_Chtx_Golgi_AcidWash_CP394-1bf/BATCH',...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/091127_A431_w3ChtxAW2/091127_A431_Chtx_Golgi_AcidWash_CP395-1bf/BATCH',...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/100215_A431_w3LDL/100215_A431_Actin_LDL_CP392-1bi/BATCH',...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/100215_A431_w3LDL/100215_A431_Actin_LDL_CP393-1bi/BATCH',...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/100215_A431_w3LDL/100215_A431_Actin_LDL_CP394-1bi/BATCH',...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/100215_A431_w3LDL/100215_A431_Actin_LDL_CP395-1bi/BATCH',...
                          '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/100224_A431_w2EGF_w3CAV1/100224_A431_EGF_Cav1_CP392-1ba/BATCH',...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/100224_A431_w2EGF_w3CAV1/100224_A431_EGF_Cav1_CP393-1ba/BATCH',...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/100224_A431_w2EGF_w3CAV1/100224_A431_EGF_Cav1_CP394-1ba/BATCH',...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/100224_A431_w2EGF_w3CAV1/100224_A431_EGF_Cav1_CP395-1ba/BATCH',...
                                              '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/100224_A431_w2EGF_w3CAV1/100224_A431_EGF_Cav1_CP392-1ba/BATCH',...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/100224_A431_w2EGF_w3CAV1/100224_A431_EGF_Cav1_CP393-1ba/BATCH',...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/100224_A431_w2EGF_w3CAV1/100224_A431_EGF_Cav1_CP394-1ba/BATCH',...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/100224_A431_w2EGF_w3CAV1/100224_A431_EGF_Cav1_CP395-1ba/BATCH',...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/091113_A431_w3GPIGFP/091113_A431GPIGFP_CP392-1be/BATCH',...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/091113_A431_w3GPIGFP/091113_A431GPIGFP_CP393-1be/BATCH',...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/091113_A431_w3GPIGFP/091113_A431GPIGFP_CP394-1be/BATCH',...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/091113_A431_w3GPIGFP/091113_A431GPIGFP_CP395-1be/BATCH',...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/100402_A431_w3Macro/100402_A431_Macropinocytosis_CP392-1bd/BATCH',...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/100402_A431_w3Macro/100402_A431_Macropinocytosis_CP393-1bd/BATCH',...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/100402_A431_w3Macro/100402_A431_Macropinocytosis_CP394-1bd/BATCH',...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/100402_A431_w3Macro/100402_A431_Macropinocytosis_CP395-1bd/BATCH',...
                                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/110721_MZ_w2EGF/110721_MZ_w2EGF-CP392-2ar/BATCH',...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/110721_MZ_w2EGF/110721_MZ_w2EGF-CP393-2ar/BATCH',...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/110721_MZ_w2EGF/110721_MZ_w2EGF-CP394-2ar/BATCH',...
                         '/BIOL/imsb/fs3/bio3/bio3/Data/Users/Prisca/endocytome/110721_MZ_w2EGF/110721_MZ_w2EGF-CP395-2ar/BATCH' };
                          vesicle_strings6={'TfVes','EEA1Ves','ChtxVes','LampVes','ChtxVes','GM130Ves','EEA1Ves','TfVes','DextranVes','GM1Ves','ChtxVes','LDLVes','EGFVes','CavVes','GPIVes','MacroVes','EGFVes'};
   assay_names={'MZ TF','MZ EEA1','A431 Chtx1','A431 Lamp','A431 Chtx2','A431 GM130','A431 EEA1','A431 TF','A431 Dextran','A431 GM1','A431 Chtx3','A431 LDL','A431 EGF','A431 CAV','A431 GPI','A431 Macro','MZ EGF'};

            channels={'RescaledRed','RescaledGreen','RescaledGreen','RescaledRed','RescaledGreen','RescaledRed','RescaledRed','RescaledGreen','RescaledRed','RescaledGreen','RescaledRed','RescaledRed','RescaledGreen','RescaledRed','RescaledRed','RescaledRed'};
%Loop over all assays
count=1;
colors={'r','k','g','b'};
for(assay=1:length(plate_paths))
    %Path to POSTANALYSIS dir
    analysis_path=strcat('C:\Users\heery\Desktop\figures\gmmoverview_simplified');
    h1=figure;
    hold on;
    if(exist(npc(strcat(plate1_paths{(assay-1)*4+1},'/','Measurements_Cells_',vesicle_strings6{count},'GMM_new.mat')),'file')~=2)
        count=count+1;
        continue;
    end;
           load(npc(strcat(plate1_paths{(assay-1)*4+1},'/','Measurements_Cells_',vesicle_strings6{count},'GMM_new.mat')));
features=eval(strcat('handles.Measurements.Cells.',vesicle_strings6{count},'GMM'));
features=cat(1,[],features{:});
%Allocate table for plates and vesicle class
table_gmm=NaN(4,size(features,2)-1);
    for(plate=1:4)
        if(exist(npc(strcat(plate1_paths{(assay-1)*4+plate},'/','Measurements_Cells_',vesicle_strings6{count},'GMM_new.mat')),'file')==2)
        load(npc(strcat(plate1_paths{(assay-1)*4+plate},'/','Measurements_Cells_',vesicle_strings6{count},'GMM_new')));
features=eval(strcat('handles.Measurements.Cells.',vesicle_strings6{count},'GMM'));
features=cat(1,[],features{:});
%For each column we plot the distribution ain a color controlled by plate
for(col=1:size(features,2))
    subplot(3,3,col);
    %Get all vesicles of class for current plate
%     table_gmm(plate,col)=nansum(features(:,col).*features(:,size(features,2)));
    if(any(~isnan(features(:,col))))
        if(col<size(features,2))
    table_gmm(plate,col)=nansum(features(:,col).*features(:,size(features,2)));
        else
table_gmm(plate,col)=nansum(features(:,col));    
        end;
%     hold on;
%     set(h,'Color',colors{plate});
    end;
    
end;
        end;
    end;
       table_gmm=bsxfun(@rdivide,table_gmm,nansum(table_gmm));
    xlswrite(strcat(analysis_path,'\',assay_names{assay}),table_gmm)
%     gcf2pdf(analysis_path,assay_names{assay});
    close(h1);
    count=count+1;
    
end;



